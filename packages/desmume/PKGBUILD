# Contributor: Nathan Jones <nathanj@insightbb.com>

pkgname=desmume
pkgver=0.9.4
pkgrel=1
pkgdesc="Nintendo DS emulator" 
arch=('i686' 'x86_64') 
license=('GPL') 
url="http://desmume.org/" 
depends=('sdl' 'gtkglext' 'libglade' 'mesa' 'libgl') 
makedepends=('intltool' 'perlxml' 'automake')
source=(http://downloads.sourceforge.net/desmume/$pkgname-$pkgver.tar.gz) 
md5sums=('0e877fe4b99d99502173efa6efae05b1')

build() { 
	cd $startdir/src/$pkgname-$pkgver 
	
	# fixing format errors
	sed -i "s/format/fmt/" $srcdir/desmume-0.9.4/src/texcache.h
	sed -i "s/format/fmt/" $srcdir/desmume-0.9.4/src/texcache.cpp
	sed -i "s/TexCache_TexFormat fmt/TexCache_TexFormat format/" $srcdir/desmume-0.9.4/src/texcache.h 

	# compile
	./configure --prefix=/usr 
	make || return 1 
	make prefix=$startdir/pkg/usr install

	# tidy up .desktop file
	cd $startdir/pkg/usr/share/applications
	sed -i -e "s# (Gtk)##" -e "s#.xpm##" -e "s#Application;##" \
	-e "s#Version=0.8##" desmume.desktop
}

