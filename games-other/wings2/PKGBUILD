# Contributor: Dragonlord <archlinux[at]dragonlord[.]cz>

pkgname=wings2
pkgver=1.3.5
pkgrel=2
pkgdesc="Fly small and agile ships in varied maps."
arch=('i686' 'x86_64')
url="http://www.wings2.net/"
license=('custom: "Wings 2 License"')
depends=('sdl' 'sdl_image' 'sdl_net' 'sdl_mixer' 'libgl' 'libstdc++5' 'desktop-file-utils')
options=('!strip' 'docs')
install=$pkgname.install
source=(http://www.wings2.net/util/download.php?file=wings2_v1.3.5_linux.tar.gz \
        $pkgname.desktop \
        Wings \
        Wings64)
md5sums=('efeac1def8547903adf282db184ad297' '6958819bc2ba835e355a5ae38f10e663' 'e0118af926a36776aaa7b79853486373' 'bc7e663ba893172400285e36ffc19fb4')

build() {
  cd "$startdir/src"
  install -d "$startdir/pkg/opt/Wings2" "$startdir/pkg/usr/bin" "$startdir/pkg/usr/share/licenses/wings2" || return 1
  cp -r "$startdir/src/Wings2" "$startdir/pkg/opt/" || return 1
  find $startdir/pkg/opt -type d -exec chmod 755 "{}" \; || return 1
  find $startdir/pkg/opt -type f -exec chmod 644 "{}" \; || return 1
#config.xml and stdout.txt files must be writable by all
  touch $startdir/pkg/opt/Wings2/bin/{config.xml,stdout.txt} || return 1
  chmod a+w $startdir/pkg/opt/Wings2/bin/{config.xml,stdout.txt} || return 1
#directory for received levels from server writable
  chmod a+w "$startdir/pkg/opt/Wings2/levels/received" || return 1
#.desktop file
  install -D -m644 "$startdir/wings2.desktop" "$startdir/pkg/usr/share/applications/wings2.desktop" || return 1
#license
  install -D -m644 "$startdir/pkg/opt/Wings2/doc/License.txt" "$startdir/pkg/usr/share/licenses/wings2/LICENSE" || return 1
#remove playlist
   rm "$startdir/pkg/opt/Wings2/music/menu_music.txt" || return 1
# ---------------------- i686 architecture ----------------------
if [ "$CARCH" = "i686" ]; then
#install run file for i686
  install -D -m755 "$startdir/src/Wings" "$startdir/pkg/usr/bin/Wings" || return 1
#making files for i686 executable
  chmod 775 "$startdir/pkg/opt/Wings2/bin/Wings" "$startdir/pkg/opt/Wings2/bin/Makelev" || return 1
#remove binaries for x86_64
   rm $startdir/pkg/opt/Wings2/bin/{Wings64,Makelev64} || return 1
# ---------------------- x86_64 architecture ----------------------
elif [ "$CARCH" = "x86_64" ]; then
#install run file for x86_64
  install -D -m755 "$startdir/src/Wings64" "$startdir/pkg/usr/bin/Wings" || return 1
#making files for x86_64 executable
  chmod 775 "$startdir/pkg/opt/Wings2/bin/Wings64" "$startdir/pkg/opt/Wings2/bin/Makelev64" || return 1
#remove i686 binaries
  rm $startdir/pkg/opt/Wings2/bin/{Wings,Makelev} || return 1
fi
}
