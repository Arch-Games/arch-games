pkgname=alienarena
pkgver=20090616
pkgrel=1
pkgdesc="Multiplayer retro sci-fi deathmatch game"
arch=('i686' 'x86_64')
url="http://alienenforcer.com/alienarena/rpa/"
license=('GPL')
depends=('curl' 'libgl' 'libjpeg' 'libxxf86dga' 'libxxf86vm' 'mesa' 'sdl' 'openal')
makedepends=('hd2u' 'p7zip' 'unzip')
source=(http://cor.planetquake.gamespy.com/files/alienarena2009-linux${pkgver}.zip
	alienarena.desktop)

md5sums=('c2b81552f6bab7810b36097fe2207c11' '46bbe3e3a93b2e5009ffd663ad462915')
 
_datadir="/usr/share/${pkgname}"
_libdir="/usr/lib/${pkgname}"
 
build() {
    cd $startdir/src/${pkgname}2009
 
    # Remove pre-compiled libs
    rm {arena,data1}/game.so
 
    cd source
    # Arch isn't multilib
    sed -i -e "s:lib64:lib:" Makefile || return 1
 
    make PREFIX=/usr \
	WITH_DATADIR=yes WITH_LIBDIR=yes \
	DATADIR="${_datadir}" LIBDIR="${_libdir}" \
     || return 1
 
    #Binary
    pwd

    install -D -m755 release/game.so $startdir/pkg/${_libdir}/arena/game.so || return 1
    install -D -m755 release/crx $startdir/pkg/usr/bin/${pkgname} || return 1
    install -D -m755 release/crded $startdir/pkg/usr/bin/${pkgname}-ded || return 1
 
    cd ..

    # Data files
    find arena botinfo data1 -type f | while read _f ; do
    install -D -m644 "$_f" "$startdir/pkg/$_datadir/$_f" || return 1
    done
 
    # Desktop entry
    install -D -m644 aa.png $startdir/pkg/usr/share/pixmaps/${pkgname}.png || return 1
    install -D -m644 $startdir/src/${pkgname}.desktop $startdir/pkg/usr/share/applications/${pkgname}.desktop || return 1
 
    # Docs
    cd docs
    dos2unix README.txt
    mkdir -p $startdir/pkg/usr/share/doc/$pkgname
    install -m644 -t $startdir/pkg/usr/share/doc/${pkgname}/ {license,README}.txt || return 1
}
