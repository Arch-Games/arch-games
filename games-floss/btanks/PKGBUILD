# Contributor: Nick B <Shirakawasuna at gmail _dot_ com>
pkgname=btanks
pkgver=0.7.5800
pkgrel=1
pkgdesc="Fast 2d tank arcade game with multiplayer and split-screen modes."
arch=('i686' 'x86_64')
url="http://btanks.sourceforge.net"
license=('GPL')
depends=('sdl' 'sdl_image' 'openal' 'libvorbis' 'libsigc++2.0' 'libgl' 'expat' 'lua')
makedepends=('scons')
source=(http://downloads.sourceforge.net/btanks/btanks-$pkgver.tar.bz2
	btanks_desktop
	btanks_script
	gcc-4.3-fixes.patch)
install=btanks.install
md5sums=('538eadf2b78897620f3ef683a4ea423a'
         'a2ddeb1e79dff8d3fd702984c8d3aab5'
         '4db2b5c91194559801c5018a2ecd41b2'
         '6e46f5a9816f68151d43c197e0bf5aa5')

build() {

  # Compile with scons
  cd $startdir/src/$pkgname-$pkgver
  patch -p1 <../gcc-4.3-fixes.patch
  scons || return 1
	
  # Copy over files
  mkdir -p $startdir/pkg/usr/share
  cp -r $startdir/src/$pkgname-$pkgver $startdir/pkg/usr/share/btanks

  # Install script
  install -D -m755 $startdir/src/btanks_script $startdir/pkg/usr/bin/btanks

  # Install desktop file
  install -D -m644 $startdir/src/btanks_desktop $startdir/pkg/usr/share/applications/btanks.desktop

  # Install icon
  install -D -m644 $startdir/src/$pkgname-$pkgver/data/tiles/icon.png $startdir/pkg/usr/share/pixmaps/btanks.png

  # Make settings saveable
  touch $startdir/pkg/usr/share/btanks/bt.xml
  chown :games $startdir/pkg/usr/share/btanks/bt.xml
  chmod 664 $startdir/pkg/usr/share/btanks/bt.xml
}
