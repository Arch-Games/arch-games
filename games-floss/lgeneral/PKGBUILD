#Contributor: Michael Krauss <hippodriver@gmx.net>
#old contributor: Jacek Poplawski <jacekpoplawski@gmail.com> 

pkgname=lgeneral
pkgver=1.2beta
pkgrel=3
pkgdesc="turn-based strategy engine heavily inspired by Panzer General"
url="http://lgames.sourceforge.net/index.php?project=LGeneral"
license=('GPL' 'custom')
depends=("sdl" "sdl_mixer")
install=()
arch=('x86_64' 'i686')
source=(
  http://downloads.sourceforge.net/lgeneral/lgeneral-1.2beta-13.tar.gz
  http://downloads.sourceforge.net/lgeneral/pg-data.tar.gz
)
md5sums=('ac8d4ec71a2e263d38a650a158e25da5' '40c4be23f60d1dc732aabe13b58fc5e3')

build() {
	cd $startdir/src/lgeneral-1.2beta-13
	./configure
	# patch it
	patch src/misc.h $startdir/patch0.diff
	make || return 1
	make install prefix=$startdir/pkg/usr
	# convert PG data
	cd $startdir/src
	mkdir -p $startdir/src/lgeneral-1.2beta-13/lgc-pg/share/games/lgeneral/
	ln -s $startdir/src/lgeneral-1.2beta-13/lgc-pg/convdata\
           $startdir/src/lgeneral-1.2beta-13/lgc-pg/share/games/lgeneral/convdata
        $startdir/src/lgeneral-1.2beta-13/lgc-pg/lgc-pg -s $startdir/src/pg-data\
        -d $startdir/pkg/usr/share/games/lgeneral
	# menu stuff
	mkdir -p $startdir/pkg/usr/share/pixmaps
	mkdir -p $startdir/pkg/usr/share/applications
	cp $startdir/src/lgeneral-1.2beta-13/lgeneral48.png\
           $startdir/pkg/usr/share/pixmaps/lgeneral.png
	cp $startdir/lgeneral.desktop $startdir/pkg/usr/share/applications
	
	# License
	mkdir -p $startdir/pkg/usr/share/licenses/lgeneral
	cp $startdir/COPYING $startdir/pkg/usr/share/licenses/lgeneral/COPYING
}
