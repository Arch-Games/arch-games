# Contributor:  Andrew Belitsky <belitsky.a@gmail.com>

pkgname=openanno-svn
pkgver=1547
pkgrel=1
pkgdesc="The OpenAnno project aims at creating an open source realtime economy simulation game with strategy elements in an isometric 2D engine loosely oriented towards Sunflower's Anno series"
url="http://www.openanno.org"
arch=('i686' 'x86_64')
license=('GPL2' 'CCPL')
depends=('python' 'fife-svn')
makedepends=('subversion' 'scons')
conflicts=('openanno')
provides=('openanno')
install=openanno-svn.install
source=(openanno.sh
        openanno.png
        openanno.desktop)

md5sums=('10fb5ba819f77a10f4a6f16731816261'
         'a7c467304645cf3493df08a2223e0bce'
         '26f9da413096fe0a5262e8a208ddf793')

_svntrunk=svn://openanno.org/openanno/trunk
_svnmod=openanno

build() {

  #Grab the sources with svn
  cd $srcdir
  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver) || return 1
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod || return 1
  fi
  msg "SVN checkout done or server timeout"
  msg "Starting make..."
  rm -r "$srcdir/$_svnmod-build"
  cp -r "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"
  cd "$srcdir/$_svnmod-build"

  #Install the package files
  install -d -m755 $pkgdir/opt/openanno
  cp -r ./* $pkgdir/opt/openanno/

  #A little configuretion to tell anno where fife is
  echo "fife_path = '/usr/share/fife'" > $pkgdir/opt/openanno/config.py

  #Openanno uses the directoy its in, so we set permissions to allow games group to use it properly.
  chown -R root:games $pkgdir/opt/openanno || return 1
  find $pkgdir/opt/openanno -type f -exec chmod 664 {} + || return 1
  find $pkgdir/opt/openanno -type d -exec chmod 775 {} + || return 1
  
  #Install the icon file
  install -D -m755 $srcdir/openanno.desktop $pkgdir/usr/share/applications/openanno.png

  #Install the bin file
  install -D -m755 $srcdir/openanno.sh $pkgdir/usr/bin/openanno
  
}

# vim:set ts=2 sw=2 et:
