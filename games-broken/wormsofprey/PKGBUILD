# Contributor: Wael Nasreddine <gandalf@siemens-mobiles.org>

pkgname=wormsofprey
pkgver=0.4.3
pkgrel=1
pkgdesc="Wörms of Prey is the new and free real-time Worms game."
depends=('sdl_ttf' 'sdl_net' 'sdl_mixer' 'sdl_image')
license="GPL"
arch=('i686')
url="http://www.wormsofprey.org"
source=(http://www.wormsofprey.org/download/wop-$pkgver-src.tar.bz2 
	    http://wormsofprey.org/download/wopdata-2005-12-21.tar.bz2 \
	    wop.desktop
	    wormsofprey-0.4.3-gcc-4.3.patch)
md5sums=('ae07e9e1092de6c447a9af2cf8e90959'
         '0bf42f28e03dcac5c8066b46d7733907'
         'a3394fada53fdcd34849cf97b4fae137'
         'dc1e8404c3cbafa1fbc88b3662683021')


	 
build() {
	
	cd $srcdir/wop-$pkgver
    patch -Np1 -i $srcdir/$pkgname-$pkgver-gcc-4.3.patch || return 1

    #Change the configuration file path from /etc to /opt/wop/etc
	#sed -i \
	#	-e "s:/etc/woprc:/opt/wop/etc/woprc:g" \
	#	"src/wopsettings.cpp" \
	#	|| return 1
	#
	#sed -i \
	#	-e "s:^data =.*$:data = /opt/wop/data:" \
	#	"woprc" \
	#	|| return 1

    # something is wrong, how Makefile.depend does not exist, i don't get it
    touch {sdlwidgets,src}/Makefile.depend || return 1

    # Starting make
    make -d || return 1

    # Installing it
    mkdir -p $pkgdir/usr/bin
    install -m755 bin/wop $pkgdir/usr/bin/wop
    mkdir -p $pkgdir/opt/wop/{data,etc}
    cp woprc $pkgdir/opt/wop/etc
    cp -R $srcdir/wopdata-2005-12-21/* $pkgdir/opt/wop/data

    # Copying .desktop file
    # P.D: plz i need an icon for it, thx
    mkdir -p $pkgdir/usr/share/applications
    cp $srcdir/wop.desktop $pkgdir/usr/share/applications/wop.desktop

    #hmmm some files are not world-readable... hmmmm WTH :o
    chmod a+r $pkgdir
    
}
