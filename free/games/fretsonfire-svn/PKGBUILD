# Contributor: Angel 'angvp' Velasquez <angvp[at]archlinux.com.ve> 
pkgname=fretsonfire-svn
pkgver=108
pkgrel=1
arch=('i686' 'x86_64')
pkgdesc="A game of musical skill and fast fingers. Play guitar with the keyboard as accurately as possible. Like guitar Hero."
url="http://fretsonfire.sourceforge.net/"
license=('GPL')
depends=('sdl' 'sdl_ttf' 'sdl_mixer' 'python-pygame' 'python-opengl' 'pil' 'python-numpy')
makedepends=('subversion')
optdepends=('glew (Used for render-to-texture support)' 'pyogg (Used for streaming OGG files from the disk)')
[ "$CARCH" = "i686" ] && optdepends[3]='psyco (Used for speed optimization)'
install=frets.install
source=(fretsonfire.desktop
		fretsonfire.file
		fretsonfire.png)
md5sums=('e792e7dfe01775c0034781393c457696' 
		 'ae24d6024235ec8ec92b8a391e675a03' 
		 '66668cad0211bf4e6ab1bd5efa8f65bf')
		 
_svntrunk=https://fretsonfire.svn.sourceforge.net/svnroot/fretsonfire/trunk
_svnmod=fretsonfire-svn
		 
build() {
	
	cd $srcdir

	if [ -d $_svnmod/.svn ]; then
      (cd $_svnmod && svn up -r $pkgver)
    else
      svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

	cd $srcdir/$_svnmod
	
	#Installing The files
	install -d $pkgdir/usr/share/fretsonfire/bin $pkgdir/usr/share/fretsonfire/data || return 1
	cp -r src/* $pkgdir/usr/share/fretsonfire/bin/ || return 1
	cp -r data/* $pkgdir/usr/share/fretsonfire/data/ || return 1
	
	#Removing junk and setting permissions
	cd $pkgdir/usr/share/fretsonfire/data
	rm -r win32/ launcher* Makefile *.svg songs/tutorial/*.svg mods/Chilly/*.svg mods/LightGraphics/*.svg 
	find $pkgdir/usr/share/fretsonfire -type f -exec chmod 664 {} + 
	find $pkgdir/usr/share/fretsonfire -type d -exec chmod 775 {} + 
	
	#Installing a bin file, icon and .desktop file
	install -D -m0755 $srcdir/fretsonfire.file $pkgdir/usr/bin/fretsonfire || return 1
	install -D $srcdir/fretsonfire.desktop  $pkgdir/usr/share/applications/fretsonfire.desktop || return 1
	install -D $srcdir/fretsonfire.png $pkgdir/usr/share/pixmaps/fretsonfire.png || return 1
	
}
